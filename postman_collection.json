{
  "info": {
    "name": "Webhook Delivery System",
    "description": "Complete API collection for the Webhook Delivery System including event ingestion, webhook receiver, and monitoring endpoints.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "api_base_url",
      "value": "https://hooks.vincentchan.cloud",
      "type": "string"
    },
    {
      "key": "receiver_base_url",
      "value": "https://receiver.vincentchan.cloud",
      "type": "string"
    },
    {
      "key": "api_key",
      "value": "",
      "type": "string",
      "description": "Auto-populated when creating a tenant via '2. Demo Tenant → Create Tenant'. For initial tenant creation, you may need to set a default/admin API key first (in production, tenant creation would be admin-only or handled via signup flow)."
    },
    {
      "key": "tenant_id",
      "value": "",
      "type": "string",
      "description": "Auto-populated when creating a tenant via '2. Demo Tenant → Create Tenant'"
    },
    {
      "key": "webhook_secret",
      "value": "",
      "type": "string",
      "description": "Auto-populated when creating a tenant via '2. Tenant Management → Create Tenant'. Used for HMAC signature generation."
    },
    {
      "key": "event_id",
      "value": "",
      "type": "string",
      "description": "Auto-populated from event creation response"
    }
  ],
  "item": [
    {
      "name": "1. API Documentation",
      "item": [
        {
          "name": "Get OpenAPI Schema",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/v1/openapi.json",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "openapi.json"]
            },
            "description": "Get the OpenAPI 3.0 schema for the API"
          }
        },
        {
          "name": "View Swagger UI",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/v1/docs",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "docs"]
            },
            "description": "Open Swagger UI documentation (browser only)"
          }
        },
        {
          "name": "View ReDoc",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{api_base_url}}/v1/redoc",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "redoc"]
            },
            "description": "Open ReDoc documentation (browser only)"
          }
        }
      ],
      "description": "Public API documentation endpoints (no authentication required)"
    },
    {
      "name": "2. Demo Tenant",
      "item": [
        {
          "name": "Create Tenant",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 201 Created', function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Tenant created with API key and secret', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.tenant_id).to.be.a('string');",
                  "    pm.expect(response.api_key).to.be.a('string');",
                  "    pm.expect(response.webhook_secret).to.be.a('string');",
                  "    pm.expect(response.api_key).to.include('tenant_');",
                  "    pm.expect(response.webhook_secret).to.include('whsec_');",
                  "});",
                  "",
                  "// Auto-save tenant credentials for use in subsequent requests",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('tenant_id', response.tenant_id);",
                  "    pm.collectionVariables.set('api_key', response.api_key);",
                  "    pm.collectionVariables.set('webhook_secret', response.webhook_secret);",
                  "    console.log('Tenant credentials saved:', {",
                  "        tenant_id: response.tenant_id,",
                  "        api_key: response.api_key,",
                  "        webhook_secret: response.webhook_secret",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],

            "body": {
              "mode": "raw",
              "raw": "{\n  \"tenant_id\": \"tenant-{{$timestamp}}\",\n  \"target_url\": \"https://receiver.vincentchan.cloud/tenant-{{$timestamp}}/webhook\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/tenants",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "tenants"]
            },
            "description": "⚠️ Tenant creation is included for demo convenience and is not part of the production interface. Zapier would supply tenant records internally.\n\nCreate a new tenant with auto-generated API key and webhook secret. The tenant_id must be lowercase alphanumeric with hyphens. Returns 409 Conflict if tenant already exists.\n\n**Important**: This request automatically saves the returned api_key, tenant_id, and webhook_secret to collection variables for use in subsequent requests."
          }
        },
        {
          "name": "Get Tenant Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Tenant details returned', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.tenant).to.be.an('object');",
                  "    pm.expect(response.tenant.tenant_id).to.be.a('string');",
                  "    pm.expect(response.tenant.target_url).to.be.a('string');",
                  "    pm.expect(response.tenant.webhook_secret).to.be.undefined;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{api_base_url}}/v1/tenants/{{tenant_id}}",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "tenants", "{{tenant_id}}"]
            },
            "description": "Get tenant details by tenant ID. Returns tenant configuration (excluding webhook secret for security). Users can only access their own tenant details."
          }
        },
        {
          "name": "Update Tenant Config - URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Configuration updated', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.message).to.include('updated');",
                  "    pm.expect(response.target_url).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"target_url\": \"https://receiver.vincentchan.cloud/{{tenant_id}}/webhook\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/tenants/{{tenant_id}}",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "tenants", "{{tenant_id}}"]
            },
            "description": "Update tenant webhook configuration by tenant ID. Users can only update their own tenant configuration."
          }
        },
        {
          "name": "Update Webhook Secret",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Secret updated', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.message).to.include('updated');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"webhook_secret\": \"whsec_{{$randomAlphaNumeric}}{{$randomAlphaNumeric}}{{$randomAlphaNumeric}}\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/tenants/{{tenant_id}}",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "tenants", "{{tenant_id}}"]
            },
            "description": "Update webhook secret using RESTful endpoint. Rotate webhook secret for HMAC signature validation."
          }
        },
        {
          "name": "Update Both URL and Secret",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Both fields updated', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.message).to.include('updated');",
                  "    pm.expect(response.target_url).to.be.a('string');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"target_url\": \"https://receiver.vincentchan.cloud/{{tenant_id}}/webhook\",\n  \"webhook_secret\": \"whsec_{{$randomAlphaNumeric}}{{$randomAlphaNumeric}}{{$randomAlphaNumeric}}\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/tenants/{{tenant_id}}",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "tenants", "{{tenant_id}}"]
            },
            "description": "Update both webhook URL and secret simultaneously using RESTful endpoint."
          }
        }
      ],
      "description": "Manage tenant webhook configuration"
    },
    {
      "name": "3. Event Ingestion",
      "item": [
        {
          "name": "Create Event - User Signup Example",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Auto-save event_id for later use",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('event_id', response.event_id);",
                  "    console.log('Event ID saved:', response.event_id);",
                  "}",
                  "",
                  "// Verify response",
                  "pm.test('Status is 201', function() {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has event_id', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.have.property('event_id');",
                  "});",
                  "",
                  "pm.test('Status is PENDING', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.status).to.equal('PENDING');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"user.signup\",\n  \"user_id\": \"user_12345\",\n  \"email\": \"john@example.com\",\n  \"name\": \"John Doe\",\n  \"timestamp\": \"{{$timestamp}}\",\n  \"metadata\": {\n    \"source\": \"web\",\n    \"campaign\": \"spring_2025\"\n  }\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/events",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events"]
            },
            "description": "Create a webhook event representing a user signup. This creates an event (not a tenant) - the payload will be delivered to your tenant's webhook URL. Returns event_id and status.\n\nNote: To create a new tenant, use POST /v1/tenants instead."
          }
        },
        {
          "name": "Create Event - Payment Received",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('event_id', response.event_id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"payment.received\",\n  \"payment_id\": \"pay_67890\",\n  \"amount\": 99.99,\n  \"currency\": \"USD\",\n  \"customer_id\": \"cust_12345\",\n  \"timestamp\": \"{{$timestamp}}\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/events",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events"]
            },
            "description": "Example payment event"
          }
        },
        {
          "name": "Create Event - Order Created",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('event_id', response.event_id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"order.created\",\n  \"order_id\": \"ord_54321\",\n  \"items\": [\n    {\"sku\": \"WIDGET-001\", \"quantity\": 2, \"price\": 29.99},\n    {\"sku\": \"GADGET-002\", \"quantity\": 1, \"price\": 49.99}\n  ],\n  \"total\": 109.97,\n  \"customer_id\": \"cust_12345\",\n  \"timestamp\": \"{{$timestamp}}\"\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/events",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events"]
            },
            "description": "Example order creation event"
          }
        },
        {
          "name": "List Events - All",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has events array', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response).to.have.property('events');",
                  "    pm.expect(response.events).to.be.an('array');",
                  "});",
                  "",
                  "// Save first event ID for detail lookup",
                  "if (pm.response.json().events.length > 0) {",
                  "    pm.collectionVariables.set('event_id', pm.response.json().events[0].event_id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{api_base_url}}/v1/events",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events"]
            },
            "description": "List all events for authenticated tenant"
          }
        },
        {
          "name": "List Events - Failed Only",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{api_base_url}}/v1/events?status=FAILED&limit=20",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events"],
              "query": [
                {
                  "key": "status",
                  "value": "FAILED"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "List only failed events with limit"
          }
        },
        {
          "name": "Get Event Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{api_base_url}}/v1/events/{{event_id}}",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events", "{{event_id}}"]
            },
            "description": "Get detailed information about a specific event (uses event_id from previous response)"
          }
        },
        {
          "name": "Retry Failed Event",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Event status is PENDING after retry', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.status).to.equal('PENDING');",
                  "});",
                  "",
                  "pm.test('Attempt count is preserved', function() {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.attempts).to.be.a('number');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{api_key}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{api_base_url}}/v1/events/{{event_id}}/retry",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events", "{{event_id}}", "retry"]
            },
            "description": "Retry a failed event. Only FAILED events can be retried. Attempt count is preserved to maintain retry history. Returns full event object."
          }
        },
        {
          "name": "Create Event - Unauthorized (no token)",
          "request": {
            "method": "POST",
            "auth": {
              "type": "noauth"
            },
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"test.event\",\n  \"test\": true\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/events",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events"]
            },
            "description": "Should return 401 Unauthorized"
          }
        },
        {
          "name": "Create Event - Invalid Token",
          "request": {
            "method": "POST",
            "auth": {
              "type": "noauth"
            },
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid_token_here",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"event\": \"test.event\",\n  \"test\": true\n}"
            },
            "url": {
              "raw": "{{api_base_url}}/v1/events",
              "host": ["{{api_base_url}}"],
              "path": ["v1", "events"]
            },
            "description": "Should return 403 Forbidden"
          }
        }
      ],
      "description": "Create and manage events for webhook delivery"
    },
    {
      "name": "4. Webhook Receiver",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{receiver_base_url}}/health",
              "host": ["{{receiver_base_url}}"],
              "path": ["health"]
            },
            "description": "Check receiver Lambda health status"
          }
        },
        {
          "name": "Receiver Documentation",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{receiver_base_url}}/docs",
              "host": ["{{receiver_base_url}}"],
              "path": ["docs"]
            },
            "description": "View Swagger UI for webhook receiver"
          }
        },
        {
          "name": "Get Webhook Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{receiver_base_url}}/{{tenant_id}}/status",
              "host": ["{{receiver_base_url}}"],
              "path": ["{{tenant_id}}", "status"]
            },
            "description": "Get webhook reception status for tenant (enabled/disabled)"
          }
        },
        {
          "name": "Disable Webhook Reception",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{receiver_base_url}}/{{tenant_id}}/disable",
              "host": ["{{receiver_base_url}}"],
              "path": ["{{tenant_id}}", "disable"]
            },
            "description": "Disable webhook reception for tenant (webhooks will return 503)"
          }
        },
        {
          "name": "Enable Webhook Reception",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{receiver_base_url}}/{{tenant_id}}/enable",
              "host": ["{{receiver_base_url}}"],
              "path": ["{{tenant_id}}", "enable"]
            },
            "description": "Enable webhook reception for tenant (resume accepting webhooks)"
          }
        }
      ],
      "description": "Manage webhook receiver status and view documentation"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{api_key}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script",
          "console.log('Request to:', pm.request.url.toString());"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script",
          "console.log('Response status:', pm.response.code);"
        ]
      }
    }
  ]
}
